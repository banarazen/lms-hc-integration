<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Zenoti â€“ Lead Management Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet"/>
<style>
/* â”€â”€ Zenoti Design System Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --zn-black:      #13171E;
  --zn-dark:       #2B3545;
  --zn-mid:        #435773;
  --zn-bg:         #F5F6FA;
  --zn-surface:    #EDEEF5;
  --zn-card:       #FFFFFF;
  --zn-text:       #0A0A0A;
  --zn-text-2:     #5F5F5F;
  --zn-text-3:     #9B9B9B;
  --zn-border:     #C7C7C7;
  --zn-border-lt:  #E8E8E8;
  --zn-blue:       #1A78C1;
  --zn-blue-dk:    #1260A0;
  --zn-blue-bg:    #E8F3FC;
  --zn-teal:       #3B5D5C;
  --zn-teal-lt:    #87D5D3;
  --zn-teal-bg:    #EAF6F6;
  --zn-red:        #D93025;
  --zn-red-bg:     #FFECEE;
  --zn-green:      #1A7A3C;
  --zn-green-bg:   #E7F4E8;
  --zn-amber:      #C07A00;
  --zn-amber-bg:   #FFEEE3;
  --zn-purple:     #6B3FA0;
  --zn-purple-bg:  #F3EEF9;
  --sidebar-w:     220px;
  --r-1:4px;--r-2:6px;--r-3:8px;--r-4:12px;--r-5:16px;--r-6:24px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Lato',sans-serif;background:var(--zn-bg);color:var(--zn-text);font-size:14px;line-height:1.5;display:flex;min-height:100vh}
#app-shell{display:flex;width:100%;min-height:100vh}

/* â”€â”€ Sidebar â”€â”€ */
#sidebar{
  width:var(--sidebar-w);min-height:100vh;background:var(--zn-black);
  display:flex;flex-direction:column;flex-shrink:0;
  position:sticky;top:0;height:100vh;overflow:hidden;z-index:50;
}
.sidebar-brand{
  display:flex;align-items:center;gap:10px;
  padding:14px;border-bottom:1px solid rgba(255,255,255,.08);
  flex-shrink:0;min-height:52px;
}
.brand-icon{
  width:28px;height:28px;border-radius:var(--r-2);
  background:var(--zn-blue);display:flex;align-items:center;justify-content:center;
  color:#fff;font-weight:900;font-size:13px;flex-shrink:0;
}
.brand-name{font-size:13px;font-weight:700;color:#fff;white-space:nowrap}
.brand-sub{font-size:10px;color:rgba(255,255,255,.35);margin-top:1px;white-space:nowrap}
.sidebar-nav{flex:1;padding:8px 0;overflow-y:auto;overflow-x:hidden}
.sidebar-nav::-webkit-scrollbar{width:0}
.nav-section-label{
  font-size:9px;font-weight:700;color:rgba(255,255,255,.3);
  letter-spacing:.12em;text-transform:uppercase;
  padding:12px 16px 4px;white-space:nowrap;
}
.nav-item{
  display:flex;align-items:center;gap:10px;padding:9px 14px;
  color:rgba(255,255,255,.55);font-size:12px;font-weight:400;
  cursor:pointer;transition:all .15s;white-space:nowrap;
  border-left:3px solid transparent;
}
.nav-item:hover{background:rgba(255,255,255,.06);color:rgba(255,255,255,.85)}
.nav-item.active{background:rgba(26,120,193,.15);color:#fff;border-left-color:var(--zn-blue);font-weight:700}
.nav-icon{width:18px;height:18px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:14px}
.nav-label{font-size:12px}
.sidebar-footer{padding:12px 14px;border-top:1px solid rgba(255,255,255,.08);flex-shrink:0}
.user-row{display:flex;align-items:center;gap:10px}
.user-avatar{width:30px;height:30px;border-radius:50%;background:var(--zn-blue);color:#fff;font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.user-name{font-size:12px;font-weight:700;color:#fff}
.user-role{font-size:10px;color:rgba(255,255,255,.35)}

/* â”€â”€ Content + Topbar â”€â”€ */
#content{flex:1;display:flex;flex-direction:column;min-width:0;overflow:hidden}
#topbar{background:var(--zn-card);border-bottom:1px solid var(--zn-border-lt);position:sticky;top:0;z-index:40;display:flex;flex-direction:column}
.topbar-main{display:flex;align-items:center;gap:12px;padding:10px 20px;border-bottom:1px solid var(--zn-border-lt);min-height:52px}
.page-title{font-size:14px;font-weight:700;color:var(--zn-text);letter-spacing:.01em}
.search-wrap{flex:1;max-width:300px;margin-left:8px;position:relative}
.search-wrap input{width:100%;padding:7px 10px 7px 30px;border:1.5px solid var(--zn-border);border-radius:var(--r-3);font-size:12px;font-family:'Lato',sans-serif;color:var(--zn-text);background:#fff;outline:none;transition:border-color .15s}
.search-wrap input:focus{border-color:var(--zn-blue)}
.search-icon{position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--zn-text-3);font-size:12px;pointer-events:none}
.topbar-actions{margin-left:auto;display:flex;align-items:center;gap:8px}
.btn-ghost{font-size:11px;font-weight:700;font-family:'Lato',sans-serif;border:1.5px solid var(--zn-border);border-radius:var(--r-2);padding:6px 12px;background:#fff;cursor:pointer;color:var(--zn-text-2);transition:all .15s}
.btn-ghost:hover{background:var(--zn-bg)}
.btn-primary-sm{font-size:11px;font-weight:700;font-family:'Lato',sans-serif;border:none;border-radius:var(--r-2);padding:6px 14px;background:var(--zn-blue);cursor:pointer;color:#fff;transition:opacity .15s}
.btn-primary-sm:hover{opacity:.9}

/* â”€â”€ Filter bar â”€â”€ */
.filter-bar{display:flex;align-items:center;gap:8px;padding:8px 20px;background:#FAFBFC;flex-wrap:wrap}
.filter-label{font-size:11px;font-weight:700;color:var(--zn-text-2);white-space:nowrap}
.date-pills{display:flex;background:var(--zn-surface);border-radius:var(--r-3);padding:3px;gap:2px}
.date-pill{padding:4px 10px;border-radius:var(--r-2);font-size:11px;font-weight:700;cursor:pointer;color:var(--zn-text-2);border:none;background:transparent;transition:all .15s;font-family:'Lato',sans-serif}
.date-pill.active{background:var(--zn-blue);color:#fff}
.filter-sep{width:1px;height:20px;background:var(--zn-border-lt);flex-shrink:0}
.filter-select{font-size:11px;font-weight:700;font-family:'Lato',sans-serif;border:1.5px solid var(--zn-border);border-radius:var(--r-2);padding:5px 8px;outline:none;color:var(--zn-text);background:#fff;cursor:pointer;transition:border-color .15s}
.filter-select:focus{border-color:var(--zn-blue)}
.filter-chip{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:var(--r-6);font-size:11px;font-weight:700;background:var(--zn-blue-bg);color:var(--zn-blue);border:1px solid var(--zn-blue)}
.filter-chip button{background:none;border:none;cursor:pointer;color:var(--zn-blue);font-size:12px;line-height:1;padding:0;margin-left:2px}

/* â”€â”€ Scroll / Main â”€â”€ */
#scroll-area{overflow-y:auto;flex:1}
main{max-width:1600px;margin:0 auto;padding:20px;display:flex;flex-direction:column;gap:20px}

/* â”€â”€ Cards â”€â”€ */
.card{background:var(--zn-card);border-radius:var(--r-4);border:1px solid var(--zn-border-lt);box-shadow:0 1px 3px rgba(0,0,0,.06);padding:20px}

/* â”€â”€ KPI Strip â”€â”€ */
.kpi-strip{display:flex;gap:12px;overflow-x:auto;padding-bottom:4px}
.kpi-strip::-webkit-scrollbar{height:4px}
.kpi-strip::-webkit-scrollbar-thumb{background:var(--zn-border);border-radius:4px}
.kpi-card{min-width:160px;flex-shrink:0;padding:16px;border-radius:var(--r-4);background:var(--zn-card);border:1px solid var(--zn-border-lt);box-shadow:0 1px 3px rgba(0,0,0,.06);cursor:default;transition:transform .2s,box-shadow .2s;animation:fadeUp .4s ease both}
.kpi-card:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.1)}
.kpi-card.alert-card{outline:2px solid var(--zn-amber);outline-offset:0}
.kpi-icon{width:32px;height:32px;border-radius:var(--r-3);display:flex;align-items:center;justify-content:center;font-size:14px;margin-bottom:10px}
.kpi-value{font-size:24px;font-weight:700;color:var(--zn-text);margin-bottom:4px;letter-spacing:-.01em}
.kpi-label{font-size:12px;font-weight:700;color:var(--zn-text-2);margin-bottom:6px;letter-spacing:.02em}
.kpi-sub{font-size:11px;color:var(--zn-text-3)}
.delta-up{color:var(--zn-green);font-size:11px;font-weight:700}
.delta-down{color:var(--zn-red);font-size:11px;font-weight:700}

/* â”€â”€ Grids â”€â”€ */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
@media(max-width:900px){.grid-2,.grid-3,.grid-4{grid-template-columns:1fr}}

/* â”€â”€ Section headers â”€â”€ */
.section-hdr{display:flex;align-items:center;gap:10px;margin-bottom:16px}
.section-icon{width:30px;height:30px;border-radius:var(--r-3);background:var(--zn-blue-bg);color:var(--zn-blue);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.section-title{font-size:14px;font-weight:700;color:var(--zn-text);letter-spacing:.01em}
.section-sub{font-size:11px;color:var(--zn-text-2);margin-top:1px}
.section-badge{margin-left:auto;padding:3px 10px;border-radius:var(--r-6);font-size:10px;font-weight:700;letter-spacing:.06em;background:var(--zn-purple-bg);color:var(--zn-purple)}

/* â”€â”€ Badges â”€â”€ */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:var(--r-6);font-size:10px;font-weight:700;letter-spacing:.04em}
.badge-teal{background:var(--zn-teal-bg);color:var(--zn-teal)}
.badge-blue{background:var(--zn-blue-bg);color:var(--zn-blue)}
.badge-amber{background:var(--zn-amber-bg);color:var(--zn-amber)}
.badge-red{background:var(--zn-red-bg);color:var(--zn-red)}
.badge-purple{background:var(--zn-purple-bg);color:var(--zn-purple)}
.badge-green{background:var(--zn-green-bg);color:var(--zn-green)}

/* â”€â”€ Funnel â”€â”€ */
.funnel-stage{border-radius:var(--r-3);padding:12px;cursor:pointer;margin-bottom:8px;transition:all .2s}
.funnel-stage:hover{opacity:.9}
.funnel-bar-wrap{height:20px;background:rgba(255,255,255,.5);border-radius:var(--r-2);overflow:hidden;margin-top:6px}
.funnel-bar{height:100%;border-radius:var(--r-2);transition:width .8s ease}
.funnel-stage-name{font-size:12px;font-weight:700;letter-spacing:.01em}
.funnel-meta{display:flex;justify-content:space-between;align-items:center}
.funnel-count{font-size:16px;font-weight:700}
.drop-off-hi{color:var(--zn-red);font-size:11px;font-weight:700}
.drop-off-md{color:var(--zn-amber);font-size:11px;font-weight:700}
.pipeline-total{background:var(--zn-teal-bg);border-radius:var(--r-3);padding:10px 14px;display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:12px}
.pipeline-total b{color:var(--zn-teal);font-size:14px;font-weight:700}

/* â”€â”€ Source table â”€â”€ */
.data-table{width:100%;border-collapse:collapse;font-size:12px}
.data-table th{text-align:left;padding:8px 8px;border-bottom:2px solid var(--zn-border-lt);color:var(--zn-text-2);font-weight:700;cursor:pointer;white-space:nowrap;font-size:11px;letter-spacing:.02em}
.data-table th:hover{color:var(--zn-text)}
.data-table td{padding:10px 8px;border-bottom:1px solid var(--zn-border-lt)}
.data-table tr:hover td{background:var(--zn-bg)}
.conv-hi{color:var(--zn-green);font-weight:700}
.conv-md{color:var(--zn-amber);font-weight:700}
.conv-lo{color:var(--zn-red);font-weight:700}
.src-dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:6px;flex-shrink:0}

/* â”€â”€ AI vs Human â”€â”€ */
.ai-metric-row{display:grid;grid-template-columns:2fr 1fr 40px 1fr;gap:4px;align-items:center;padding:8px 0;border-bottom:1px solid var(--zn-border-lt);font-size:12px}
.ai-metric-label{color:var(--zn-text-2)}
.ai-val{text-align:center;font-weight:700;padding:4px 8px;border-radius:var(--r-3)}
.ai-val.winner{background:var(--zn-teal-bg);color:var(--zn-teal)}
.ai-val.loser{color:var(--zn-text-3)}
.human-val{text-align:center;font-weight:700;padding:4px 8px;border-radius:var(--r-3)}
.human-val.winner{background:var(--zn-blue-bg);color:var(--zn-blue)}
.human-val.loser{color:var(--zn-text-3)}
.vs-sep{text-align:center;color:var(--zn-text-3);font-size:10px;font-weight:700}
.ai-header-box{text-align:center;padding:10px;border-radius:var(--r-3);background:var(--zn-teal-bg);margin-bottom:12px}
.human-header-box{text-align:center;padding:10px;border-radius:var(--r-3);background:var(--zn-blue-bg);margin-bottom:12px}

/* â”€â”€ Agent leaderboard â”€â”€ */
.agent-row{border-radius:var(--r-4);padding:12px;cursor:pointer;transition:all .15s;border:1.5px solid transparent;margin-bottom:8px}
.agent-row:hover{background:var(--zn-bg);border-color:var(--zn-border)}
.agent-row.active{background:var(--zn-blue-bg);border-color:var(--zn-blue)}
.agent-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0}
.agent-detail{display:none;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px;padding-top:12px;border-top:1px solid rgba(0,0,0,.06)}
.agent-row.active .agent-detail{display:grid}
.agent-stat{text-align:center}
.agent-stat-val{font-size:13px;font-weight:700;color:var(--zn-text)}
.agent-stat-lbl{font-size:10px;color:var(--zn-text-2);margin-top:2px;letter-spacing:.02em}

/* â”€â”€ Tab pills â”€â”€ */
.tab-pills{display:flex;gap:4px}
.tab-pill{padding:5px 12px;border-radius:var(--r-6);font-size:11px;font-weight:700;cursor:pointer;border:none;background:var(--zn-surface);color:var(--zn-text-2);transition:all .15s;font-family:'Lato',sans-serif}
.tab-pill.active{background:var(--zn-blue);color:#fff}

/* â”€â”€ Type bars â”€â”€ */
.type-row{margin-bottom:10px}
.type-bar-bg{height:8px;background:var(--zn-surface);border-radius:var(--r-1);overflow:hidden;margin-top:4px}
.type-bar-fill{height:100%;border-radius:var(--r-1);transition:width .7s ease}
.type-meta{display:flex;justify-content:space-between;align-items:center;font-size:11px}

/* â”€â”€ Center cards â”€â”€ */
.center-card{border-radius:var(--r-4);padding:14px;border:1.5px solid var(--zn-border-lt);transition:border-color .15s}
.center-card:hover{border-color:var(--zn-blue)}
.center-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px;text-align:center}
.center-stat{background:var(--zn-bg);border-radius:var(--r-3);padding:8px}
.center-stat-val{font-size:14px;font-weight:700;color:var(--zn-text)}
.center-stat-lbl{font-size:10px;color:var(--zn-text-2);margin-top:2px;letter-spacing:.02em}
.center-stat.at-risk-hi{background:var(--zn-red-bg)}
.center-stat.at-risk-hi .center-stat-val{color:var(--zn-red)}
.center-stat.at-risk-md{background:var(--zn-amber-bg)}
.center-stat.at-risk-md .center-stat-val{color:var(--zn-amber)}

/* â”€â”€ Nurture â”€â”€ */
.nurture-channel{border-radius:var(--r-3);padding:14px;border:1.5px solid var(--zn-border-lt)}
.nurture-metric{display:flex;justify-content:space-between;font-size:11px;margin-bottom:6px}
.nurture-metric-lbl{color:var(--zn-text-2)}
.nurture-metric-val{font-weight:700;color:var(--zn-text)}
.progress-bar{height:6px;background:var(--zn-surface);border-radius:3px;overflow:hidden;margin-top:6px}
.progress-fill{height:100%;border-radius:3px;transition:width .7s ease;background:var(--zn-blue)}

/* â”€â”€ Risk cards â”€â”€ */
.risk-card{border-radius:var(--r-3);padding:12px;background:#fff;border:1.5px solid var(--zn-border-lt);border-left:4px solid var(--zn-amber);margin-bottom:8px;transition:all .2s}
.risk-card.critical{border-left-color:var(--zn-red)}
.risk-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.08)}
.risk-actions{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap}
.btn-action{padding:5px 12px;border-radius:var(--r-6);font-size:11px;font-weight:700;cursor:pointer;border:1.5px solid;transition:all .15s;font-family:'Lato',sans-serif}
.btn-cta{background:var(--zn-blue);color:#fff;border-color:var(--zn-blue)}
.btn-cta:hover{opacity:.9}
.btn-outline-blue{background:#fff;color:var(--zn-blue);border-color:var(--zn-blue)}
.btn-outline-blue:hover{background:var(--zn-blue-bg)}
.btn-muted{background:#fff;color:var(--zn-text-2);border-color:var(--zn-border)}
.btn-muted:hover{background:var(--zn-bg)}
.btn-dismiss{background:#fff;color:var(--zn-text-3);border-color:var(--zn-border);margin-left:auto}

/* â”€â”€ Pie legend â”€â”€ */
.pie-legend{display:flex;flex-direction:column;gap:8px;flex:1;min-width:0}
.pie-legend-item{display:flex;align-items:center;gap:8px;font-size:12px}
.pie-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.pie-bar-bg{flex:1;height:5px;background:var(--zn-surface);border-radius:3px;overflow:hidden}
.pie-bar-fill{height:100%;border-radius:3px}

/* â”€â”€ Chatbot â”€â”€ */
#chat-fab{position:fixed;bottom:24px;right:24px;width:52px;height:52px;border-radius:50%;background:var(--zn-blue);color:#fff;border:none;cursor:pointer;font-size:20px;box-shadow:0 4px 20px rgba(26,120,193,.4);transition:transform .2s;z-index:200;display:flex;align-items:center;justify-content:center}
#chat-fab:hover{transform:scale(1.1)}
#chat-panel{position:fixed;bottom:16px;right:16px;width:380px;max-height:88vh;background:#FAFBFC;border-radius:var(--r-5);box-shadow:0 8px 40px rgba(0,0,0,.15);z-index:200;display:none;flex-direction:column;overflow:hidden;border:1px solid var(--zn-border-lt)}
#chat-panel.open{display:flex}
.chat-header{background:var(--zn-blue);padding:12px 16px;display:flex;align-items:center;gap:10px;color:#fff;flex-shrink:0}
.chat-avatar{width:34px;height:34px;border-radius:50%;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:16px}
.chat-header-name{font-size:13px;font-weight:700}
.chat-header-sub{font-size:10px;opacity:.75}
.chat-close{width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,.2);border:none;color:#fff;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;transition:background .15s}
.chat-close:hover{background:rgba(255,255,255,.3)}
.chat-messages{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px;min-height:160px;max-height:320px}
.chat-messages::-webkit-scrollbar{width:4px}
.chat-messages::-webkit-scrollbar-thumb{background:var(--zn-border);border-radius:4px}
.msg-wrap{display:flex;gap:8px;animation:fadeUp .3s ease}
.msg-wrap.user{flex-direction:row-reverse}
.msg-icon{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0;color:#fff}
.msg-icon.ai{background:var(--zn-blue);font-size:14px}
.msg-icon.user{background:var(--zn-dark)}
.msg-bubble{max-width:72%;padding:10px 12px;border-radius:14px;font-size:12px;line-height:1.55;white-space:pre-wrap}
.msg-bubble.ai{background:#fff;border:1px solid var(--zn-border-lt);color:var(--zn-text);border-top-left-radius:4px}
.msg-bubble.user{background:var(--zn-blue);color:#fff;border-top-right-radius:4px}
.msg-action{display:block;margin-top:8px;padding:6px 12px;background:var(--zn-blue);color:#fff;border:none;border-radius:var(--r-3);font-size:11px;font-weight:700;cursor:pointer;width:100%;font-family:'Lato',sans-serif;transition:opacity .15s}
.msg-action:hover{opacity:.9}
.thinking{display:flex;align-items:center;gap:4px;padding:10px 14px;background:#fff;border:1px solid var(--zn-border-lt);border-radius:14px;border-top-left-radius:4px}
.dot{width:7px;height:7px;border-radius:50%;background:var(--zn-blue);animation:bounce 1s infinite}
.dot:nth-child(2){animation-delay:.2s}
.dot:nth-child(3){animation-delay:.4s}
.chat-chips{border-top:1px solid var(--zn-border-lt);padding:10px;flex-shrink:0}
.chip-cats{display:flex;gap:6px;overflow-x:auto;padding-bottom:6px}
.chip-cats::-webkit-scrollbar{display:none}
.chip-cat{padding:4px 10px;border-radius:var(--r-6);font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap;border:none;background:var(--zn-surface);color:var(--zn-text-2);font-family:'Lato',sans-serif;transition:all .15s;flex-shrink:0}
.chip-cat.active{background:var(--zn-blue);color:#fff}
.chip-list{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}
.chip{padding:5px 10px;border-radius:14px;font-size:11px;font-weight:700;cursor:pointer;border:1.5px solid var(--zn-blue);color:var(--zn-blue);background:var(--zn-blue-bg);transition:all .15s;font-family:'Lato',sans-serif}
.chip:hover{background:var(--zn-blue);color:#fff;transform:translateY(-1px)}
.chat-input-row{border-top:1px solid var(--zn-border-lt);padding:10px;display:flex;gap:8px;flex-shrink:0}
.chat-input{flex:1;border:1.5px solid var(--zn-border);border-radius:var(--r-3);padding:8px 12px;font-size:12px;outline:none;font-family:'Lato',sans-serif;transition:border-color .15s}
.chat-input:focus{border-color:var(--zn-blue)}
.chat-send{width:36px;height:36px;border-radius:var(--r-3);background:var(--zn-blue);color:#fff;border:none;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:opacity .15s;flex-shrink:0}
.chat-send:hover{opacity:.85}
.chat-powered{text-align:center;font-size:10px;color:var(--zn-text-3);padding:4px 0 2px}

/* â”€â”€ Animations â”€â”€ */
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ Loading â”€â”€ */
#loading{position:fixed;inset:0;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:999;gap:16px}
#loading .logo-big{width:52px;height:52px;border-radius:var(--r-4);background:var(--zn-blue);display:flex;align-items:center;justify-content:center;color:#fff;font-size:22px;font-weight:900}
#loading p{color:var(--zn-text-2);font-size:13px}
.spinner{width:32px;height:32px;border:3px solid var(--zn-blue-bg);border-top-color:var(--zn-blue);border-radius:50%;animation:spin .8s linear infinite}

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--zn-border);border-radius:3px}

/* â”€â”€ Utils â”€â”€ */
.flex{display:flex}.items-center{align-items:center}.justify-between{justify-content:space-between}
.gap-2{gap:8px}.gap-3{gap:12px}.flex-1{flex:1}.flex-wrap{flex-wrap:wrap}
.text-xs{font-size:11px}.text-sm{font-size:12px}.text-muted{color:var(--zn-text-2)}.font-700{font-weight:700}
.mt-2{margin-top:8px}.mt-3{margin-top:12px}.mb-2{margin-bottom:8px}.w-full{width:100%}
.divider{border:none;border-top:1px solid var(--zn-border-lt);margin:4px 0}
</style>
</head>
<body>

<div id="loading">
  <div class="logo-big">Z</div>
  <div class="spinner"></div>
  <p>Loading Lead Management Dashboardâ€¦</p>
</div>

<div id="app-shell">

  <!-- SIDEBAR -->
  <nav id="sidebar">
    <div class="sidebar-brand">
      <div class="brand-icon">Z</div>
      <div>
        <div class="brand-name">Zenoti LMS</div>
        <div class="brand-sub">AI Lead Manager</div>
      </div>
    </div>
    <div class="sidebar-nav">
      <div class="nav-section-label">Analytics</div>
      <div class="nav-item active"><span class="nav-icon">ğŸ“Š</span><span class="nav-label">Dashboard</span></div>
      <div class="nav-item"><span class="nav-icon">ğŸ‘¥</span><span class="nav-label">Leads</span></div>
      <div class="nav-item"><span class="nav-icon">ğŸ“ˆ</span><span class="nav-label">Pipeline</span></div>
      <div class="nav-item"><span class="nav-icon">ğŸ¤–</span><span class="nav-label">AI Agents</span></div>
      <div class="nav-section-label">Outreach</div>
      <div class="nav-item"><span class="nav-icon">ğŸ“¬</span><span class="nav-label">Nurture</span></div>
      <div class="nav-item"><span class="nav-icon">ğŸ“</span><span class="nav-label">Calls</span></div>
      <div class="nav-item"><span class="nav-icon">ğŸ’¬</span><span class="nav-label">Messaging</span></div>
      <div class="nav-section-label">Settings</div>
      <div class="nav-item"><span class="nav-icon">ğŸ“</span><span class="nav-label">Centers</span></div>
      <div class="nav-item"><span class="nav-icon">âš™ï¸</span><span class="nav-label">Settings</span></div>
    </div>
    <div class="sidebar-footer">
      <div class="user-row">
        <div class="user-avatar">BK</div>
        <div>
          <div class="user-name">Bala Krishna</div>
          <div class="user-role">Business Owner</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- CONTENT -->
  <div id="content">
    <div id="topbar">
      <div class="topbar-main">
        <div class="page-title">Lead Management Dashboard</div>
        <div class="search-wrap">
          <span class="search-icon">ğŸ”</span>
          <input id="lead-search" type="text" placeholder="Search leads, agents, sourcesâ€¦" oninput="applySearch(this.value)"/>
        </div>
        <div class="topbar-actions">
          <button class="btn-ghost" onclick="clearAllFilters()" id="clear-filters-btn" style="display:none;color:var(--zn-blue);border-color:var(--zn-blue)">âœ• Clear filters</button>
          <button class="btn-ghost">â¬‡ Export CSV</button>
          <button class="btn-primary-sm">+ New Lead</button>
        </div>
      </div>
      <div class="filter-bar">
        <span class="filter-label">ğŸ“…</span>
        <div class="date-pills">
          <button class="date-pill" onclick="setRange('Today')">Today</button>
          <button class="date-pill" onclick="setRange('7d')">7d</button>
          <button class="date-pill active" onclick="setRange('30d')">30d</button>
          <button class="date-pill" onclick="setRange('60d')">60d</button>
          <button class="date-pill" id="custom-date-pill" onclick="setRange('custom')">Custom</button>
        </div>
        <div id="custom-dates" style="display:none;align-items:center;gap:4px">
          <input type="date" id="date-from" class="filter-select"/>
          <span style="font-size:11px;color:var(--zn-text-2)">â†’</span>
          <input type="date" id="date-to" class="filter-select"/>
        </div>
        <div class="filter-sep"></div>
        <span class="filter-label">ğŸ“¡</span>
        <select class="filter-select" id="src-filter" onchange="applyFilter()">
          <option value="">All Sources</option>
          <option>AI Receptionist</option><option>Facebook Ads</option>
          <option>Google Ads</option><option>Website Form</option>
          <option>Walk-in</option><option>Referral</option>
        </select>
        <div class="filter-sep"></div>
        <span class="filter-label">ğŸ“</span>
        <select class="filter-select" id="ctr-filter" onchange="applyFilter()">
          <option value="">All Centers</option>
          <option>Beverly Hills</option><option>Santa Monica</option><option>Pasadena</option>
        </select>
        <div class="filter-sep"></div>
        <span class="filter-label">ğŸ’‰</span>
        <select class="filter-select" id="type-filter" onchange="applyFilter()">
          <option value="">All Types</option>
          <option>Botox</option><option>Laser Hair Removal</option>
          <option>Facials</option><option>CoolSculpting</option>
          <option>Membership</option><option>Consultation</option>
        </select>
        <div class="filter-sep"></div>
        <span class="filter-label">ğŸ‘¤</span>
        <select class="filter-select" id="agent-filter" onchange="applyFilter()">
          <option value="">All Agents</option>
          <option>Sarah Chen</option><option>Marcus Rivera</option>
          <option>Aria AI</option><option>Nexus AI</option>
        </select>
        <div class="filter-sep"></div>
        <span class="filter-label">â¬‡</span>
        <select class="filter-select" id="stage-filter" onchange="applyFilter()">
          <option value="">All Stages</option>
          <option>New</option><option>Contacted</option><option>Interested</option>
          <option>Qualified</option><option>Booked</option><option>Won</option><option>Lost</option>
        </select>
        <div id="active-filter-chips" style="display:flex;gap:4px;flex-wrap:wrap;margin-left:4px"></div>
      </div>
    </div>

    <div id="scroll-area">
      <main>
        <!-- KPI STRIP -->
        <div class="kpi-strip" id="kpi-strip"></div>

        <!-- Funnel + Source Pie -->
        <div class="grid-2">
          <div class="card">
            <div class="section-hdr">
              <div class="section-icon">â¬‡</div>
              <div><div class="section-title">Lead Funnel</div><div class="section-sub">Stage-by-stage conversion</div></div>
            </div>
            <div id="funnel-stages"></div>
            <div class="pipeline-total"><span style="color:var(--zn-text-2);font-size:12px">Total Pipeline Value</span><b id="pipeline-val"></b></div>
          </div>
          <div class="card">
            <div class="section-hdr">
              <div class="section-icon">ğŸ“¡</div>
              <div><div class="section-title">Lead Source Distribution</div><div class="section-sub">Volume + conversion by channel</div></div>
            </div>
            <div style="display:flex;align-items:center;gap:16px">
              <div style="flex-shrink:0;width:120px;height:120px"><canvas id="pieChart" style="width:120px;height:120px;display:block"></canvas></div>
              <div class="pie-legend" id="pie-legend" style="flex:1;min-width:0"></div>
            </div>
            <div id="best-source-badge" class="mt-3"></div>
          </div>
        </div>

        <!-- Source Table -->
        <div class="card">
          <div class="section-hdr">
            <div class="section-icon">ğŸ“Š</div>
            <div><div class="section-title">Lead Source Performance</div><div class="section-sub">Click column headers to sort</div></div>
          </div>
          <div style="overflow-x:auto"><table class="data-table" id="source-table"></table></div>
        </div>

        <!-- AI vs Human -->
        <div class="card">
          <div class="section-hdr">
            <div class="section-icon">ğŸ¤–</div>
            <div><div class="section-title">AI Agent vs Human Agent</div><div class="section-sub">Performance comparison â€” Zenoti's key differentiator</div></div>
            <span class="section-badge">KEY DIFFERENTIATOR</span>
          </div>
          <div class="grid-2">
            <div>
              <div class="grid-2" style="gap:8px;margin-bottom:12px">
                <div class="ai-header-box">
                  <div style="font-size:22px">ğŸ¤–</div>
                  <div style="font-weight:700;font-size:13px;color:var(--zn-teal)">AI Agents</div>
                  <div style="font-size:11px;color:var(--zn-text-2)">Aria + Nexus</div>
                </div>
                <div class="human-header-box">
                  <div style="font-size:22px">ğŸ‘¤</div>
                  <div style="font-weight:700;font-size:13px;color:var(--zn-blue)">Human Agents</div>
                  <div style="font-size:11px;color:var(--zn-text-2)">Sarah + Marcus</div>
                </div>
              </div>
              <div id="ai-metrics"></div>
            </div>
            <div>
              <div style="font-size:11px;font-weight:700;color:var(--zn-text-2);margin-bottom:8px">Conversion Rate Trend (6 months)</div>
              <canvas id="aiTrendChart" height="180"></canvas>
              <div style="background:var(--zn-teal-bg);border-radius:var(--r-3);padding:10px;margin-top:10px;font-size:11px">
                <div style="font-weight:700;color:var(--zn-teal)">ğŸ§  AI Best Use Cases</div>
                <div style="color:var(--zn-text-2);margin-top:4px;line-height:1.6">Botox inquiries (28.5% vs 22%), Consultation triage, Membership upsells (33.1%), After-hours leads (100% vs 0% coverage)</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Agent Leaderboard + Trends -->
        <div class="grid-2">
          <div class="card">
            <div class="section-hdr">
              <div class="section-icon">ğŸ†</div>
              <div><div class="section-title">Agent Leaderboard</div><div class="section-sub">Click a row to expand details</div></div>
            </div>
            <div id="agent-list"></div>
          </div>
          <div class="card">
            <div class="section-hdr" style="margin-bottom:10px">
              <div class="section-icon">ğŸ“ˆ</div>
              <div><div class="section-title">Lead Capture Trends</div><div class="section-sub">Daily volume</div></div>
              <div class="tab-pills" style="margin-left:auto">
                <button class="tab-pill active" onclick="setTrendView('total',this)">Total</button>
                <button class="tab-pill" onclick="setTrendView('sources',this)">Sources</button>
                <button class="tab-pill" onclick="setTrendView('newret',this)">New/Return</button>
              </div>
            </div>
            <canvas id="trendChart" height="210"></canvas>
          </div>
        </div>

        <!-- Lead Type + Center -->
        <div class="grid-2">
          <div class="card">
            <div class="section-hdr">
              <div class="section-icon">ğŸ’‰</div>
              <div><div class="section-title">Lead Type Analysis</div><div class="section-sub">By service category</div></div>
            </div>
            <div id="type-bars"></div>
            <div class="mt-3" style="font-size:11px;color:var(--zn-text-2);padding-top:8px;border-top:1px solid var(--zn-border-lt)">
              ğŸ† <b>Fastest convert:</b> Facials (3.1d) &nbsp;|&nbsp; ğŸ’° <b>Best deal size:</b> Membership ($1,800)
            </div>
          </div>
          <div class="card">
            <div class="section-hdr">
              <div class="section-icon">ğŸ“</div>
              <div><div class="section-title">Center Performance</div><div class="section-sub">Multi-location rankings</div></div>
            </div>
            <div id="center-list"></div>
          </div>
        </div>

        <!-- Nurture -->
        <div class="card">
          <div class="section-hdr">
            <div class="section-icon">ğŸ“¬</div>
            <div><div class="section-title">Nurture &amp; Outreach Analytics</div><div class="section-sub">All communication channels</div></div>
          </div>
          <div id="nurture-grid"></div>
          <div class="grid-2 mt-3">
            <div style="border:1.5px solid var(--zn-border-lt);border-radius:var(--r-3);padding:14px">
              <div class="flex justify-between items-center mb-2">
                <span style="font-size:12px;font-weight:700;color:var(--zn-text-2)">ğŸ”„ Sequence Completion</span>
                <span style="font-size:14px;font-weight:700;color:var(--zn-blue)">68.4%</span>
              </div>
              <div class="progress-bar"><div class="progress-fill" style="width:68.4%"></div></div>
              <div style="font-size:11px;color:var(--zn-text-2);margin-top:6px">412 sequences started</div>
            </div>
            <div style="border:1.5px solid var(--zn-border-lt);border-radius:var(--r-3);padding:14px">
              <div class="flex justify-between items-center">
                <span style="font-size:12px;font-weight:700;color:var(--zn-text-2)">â™»ï¸ Re-engaged Leads</span>
                <span style="font-size:14px;font-weight:700;color:var(--zn-green)">47</span>
              </div>
              <div style="font-size:11px;color:var(--zn-text-2);margin-top:6px">Responded after nurture sequence</div>
              <div style="font-size:11px;font-weight:700;color:var(--zn-blue);margin-top:4px">~$65,800 potential revenue</div>
            </div>
          </div>
        </div>

        <!-- Leads at Risk -->
        <div class="card">
          <div class="section-hdr">
            <div class="section-icon">âš ï¸</div>
            <div><div class="section-title">Leads at Risk</div><div class="section-sub">No activity in 5+ days â€” take action now</div></div>
            <span class="badge badge-amber" style="margin-left:auto" id="risk-count-badge">5 active</span>
          </div>
          <div id="risk-list"></div>
        </div>

        <div style="height:80px"></div>
      </main>
    </div>
  </div>
</div>

<!-- CHATBOT FAB -->
<button id="chat-fab" onclick="toggleChat()">âœ¦</button>

<!-- CHAT PANEL -->
<div id="chat-panel">
  <div class="chat-header">
    <div class="chat-avatar">âœ¦</div>
    <div style="flex:1">
      <div class="chat-header-name">Analytics Assistant</div>
      <div class="chat-header-sub">Powered by Claude AI Â· Live data</div>
    </div>
    <button class="chat-close" onclick="toggleChat()">âœ•</button>
  </div>
  <div class="chat-messages" id="chat-messages"></div>
  <div class="chat-chips">
    <div class="chip-cats" id="chip-cats"></div>
    <div class="chip-list" id="chip-list"></div>
  </div>
  <div class="chat-input-row">
    <input class="chat-input" id="chat-input" placeholder="Ask anything about your leadsâ€¦" onkeydown="if(event.key==='Enter')sendChat()"/>
    <button class="chat-send" onclick="sendChat()">â†‘</button>
  </div>
  <div class="chat-powered">Claude claude-sonnet-4-6 Â· RAG over your lead data</div>
</div>

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COLORS={
  sources:['#1A78C1','#3B5D5C','#C07A00','#6B3FA0','#D93025','#1A7A3C'],
  agents: ['#1A78C1','#3B5D5C','#6B3FA0','#C07A00'],
  types:  ['#1A78C1','#3B5D5C','#C07A00','#6B3FA0','#D93025','#1A7A3C'],
};
const SOURCES=[
  {name:'AI Receptionist',leads:312,converted:89,revenue:187400,cpl:0,   convRate:28.5,avgDeal:2106},
  {name:'Facebook Ads',   leads:287,converted:63,revenue:121800,cpl:94,  convRate:21.9,avgDeal:1933},
  {name:'Google Ads',     leads:241,converted:58,revenue:134600,cpl:118, convRate:24.1,avgDeal:2321},
  {name:'Website Form',   leads:156,converted:31,revenue:68200, cpl:0,   convRate:19.9,avgDeal:2200},
  {name:'Walk-in',        leads:142,converted:41,revenue:89300, cpl:0,   convRate:28.9,avgDeal:2178},
  {name:'Referral',       leads:109,converted:35,revenue:97500, cpl:0,   convRate:32.1,avgDeal:2786},
];
const TYPES=[
  {name:'Botox',             leads:284,convRate:26.4,avgDeal:850, days:4.2,revenue:63700},
  {name:'Laser Hair Removal',leads:221,convRate:22.8,avgDeal:1200,days:6.1,revenue:60400},
  {name:'Facials',           leads:187,convRate:31.2,avgDeal:280, days:3.1,revenue:16400},
  {name:'CoolSculpting',     leads:156,convRate:18.5,avgDeal:2400,days:8.7,revenue:69100},
  {name:'Membership',        leads:142,convRate:35.9,avgDeal:1800,days:5.4,revenue:91700},
  {name:'Consultation',      leads:257,convRate:15.2,avgDeal:150, days:2.3,revenue:5900},
];
const AGENTS=[
  {id:'a1',name:'Sarah Chen',   type:'human',      av:'SC',center:'Beverly Hills',handled:312,converted:78, convRate:25.0,respMin:8.4, revenue:164800,prev:22.1,bestSrc:'Referral',    bestType:'Membership'},
  {id:'a2',name:'Marcus Rivera',type:'human',      av:'MR',center:'Santa Monica', handled:287,converted:67, convRate:23.3,respMin:11.2,revenue:141200,prev:24.8,bestSrc:'Google Ads', bestType:'CoolSculpting'},
  {id:'a3',name:'Aria AI',      type:'ai_recept',  av:'AI',center:'All Centers',  handled:489,converted:128,convRate:26.2,respMin:0.3, revenue:218700,prev:23.1,bestSrc:'AI Recept.', bestType:'Botox'},
  {id:'a4',name:'Nexus AI',     type:'ai_outbound',av:'NX',center:'All Centers',  handled:159,converted:44, convRate:27.7,respMin:0.1, revenue:93800, prev:22.4,bestSrc:'Facebook Ads',bestType:'Membership'},
];
const FUNNEL=[
  {stage:'New',       count:1247,value:2619000,dropOff:null,avgDays:0.5, color:'#1A78C1'},
  {stage:'Contacted', count:1089,value:2287000,dropOff:12.7,avgDays:1.2, color:'#3B5D5C'},
  {stage:'Interested',count:847, value:1779000,dropOff:22.2,avgDays:2.8, color:'#6B3FA0'},
  {stage:'Qualified', count:612, value:1285000,dropOff:27.7,avgDays:4.1, color:'#C07A00'},
  {stage:'Booked',    count:389, value:817000, dropOff:36.4,avgDays:2.1, color:'#87D5D3'},
  {stage:'Won',       count:317, value:698000, dropOff:18.5,avgDays:1.4, color:'#1A7A3C'},
  {stage:'Lost',      count:244, value:0,      dropOff:null,avgDays:null, color:'#D93025'},
];
const CENTERS=[
  {name:'Beverly Hills',leads:487,convRate:26.8,revenue:242100,agents:2,atRisk:12},
  {name:'Santa Monica', leads:412,convRate:23.1,revenue:198700,agents:2,atRisk:18},
  {name:'Pasadena',     leads:348,convRate:21.4,revenue:157500,agents:1,atRisk:17},
];
const AI_VS_HUMAN={
  ai:   {handled:648,converted:172,convRate:26.5,respMin:0.25,revenue:312500,cpc:18, handoff:12.3,sentiment:4.1},
  human:{handled:599,converted:145,convRate:24.2,respMin:9.8, revenue:306000,cpc:142,handoff:0,   sentiment:4.3},
  trend:[{m:'Sep',ai:22,h:24},{m:'Oct',ai:24,h:23},{m:'Nov',ai:25,h:24},{m:'Dec',ai:26,h:24},{m:'Jan',ai:26,h:25},{m:'Feb',ai:27,h:24}]
};
const NURTURE={
  email:  {sent:2847,openRate:34.2,replyRate:8.7},
  sms:    {sent:1934,responseRate:22.4,optOut:1.2},
  aiCall: {made:648, connect:67.3,conv:26.5},
  humCall:{made:834, connect:71.8,conv:24.2},
};
const RISK_LEADS=[
  {id:'L1',name:'Emma Wilson',   src:'Facebook Ads',   type:'CoolSculpting',stage:'Interested',days:9,agent:'Marcus Rivera',val:2400,pri:'high'},
  {id:'L2',name:'James Park',    src:'Google Ads',     type:'Membership',   stage:'Qualified',  days:8,agent:'Sarah Chen',   val:1800,pri:'high'},
  {id:'L3',name:'Sofia Martinez',src:'AI Receptionist',type:'Botox',        stage:'Interested', days:7,agent:'Aria AI',      val:850, pri:'medium'},
  {id:'L4',name:'Noah Thompson', src:'Website Form',   type:'Laser',        stage:'Contacted',  days:6,agent:'Unassigned',   val:1200,pri:'medium'},
  {id:'L5',name:'Ava Johnson',   src:'Referral',       type:'Facials',      stage:'Interested', days:5,agent:'Marcus Rivera',val:280, pri:'low'},
];
function genDaily(days){
  const arr=[],now=new Date();
  for(let i=days-1;i>=0;i--){
    const d=new Date(now);d.setDate(d.getDate()-i);
    const lbl=`${d.getMonth()+1}/${d.getDate()}`;
    const wknd=(d.getDay()===0||d.getDay()===6);
    const base=wknd?14:22,noise=Math.floor(Math.random()*10-5);
    const total=Math.max(8,base+noise+Math.floor(i/12));
    arr.push({date:lbl,total,new:Math.floor(total*.68),ret:Math.floor(total*.32),
      ai:Math.floor(total*.25),fb:Math.floor(total*.28),goog:Math.floor(total*.22),web:Math.floor(total*.12)});
  }return arr;
}
const DAILY=genDaily(60);

// â”€â”€â”€ FORMAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fmt={
  usd:v=>v>=1000?`$${(v/1000).toFixed(1)}K`:`$${v}`,
  num:v=>v>=1000?`${(v/1000).toFixed(1)}K`:`${v}`,
  min:v=>v<1?`${Math.round(v*60)}s`:`${v.toFixed(1)}m`,
  delta:(v,inv=false)=>{
    const pos=inv?v<0:v>0,sign=v>0?'â†‘':'â†“';
    return `<span class="${pos?'delta-up':'delta-down'}">${sign} ${Math.abs(v).toFixed(1)}%</span>`;
  }
};

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentRange='30d',activeStage=null,activeAgent=null;
let trendChartInst=null,aiTrendInst=null,pieInst=null;
let sortKey='leads',sortDir=-1;
const dismissed=new Set();

// â”€â”€â”€ KPIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RANGE_FACTOR={'Today':0.033,'7d':0.233,'30d':0.5,'60d':1.0};
const KPI_BASE={totalLeads:1247,newLeads:847,retLeads:400,convRate:25.4,revenue:698400,atRisk:47,respMin:4.2,cpl:94,velocity:18.3,prevConv:23.1,prevRev:589200};
function renderKPIs(){
  const f=RANGE_FACTOR[currentRange]||0.5;
  const k={...KPI_BASE,totalLeads:Math.round(KPI_BASE.totalLeads*f),newLeads:Math.round(KPI_BASE.newLeads*f),revenue:Math.round(KPI_BASE.revenue*f)};
  const revDelta=(k.revenue-KPI_BASE.prevRev*f)/(KPI_BASE.prevRev*f)*100;
  const kpis=[
    {lbl:'Total Leads',       val:fmt.num(k.totalLeads),sub:fmt.delta(k.velocity)+' vs prior',                     icon:'ğŸ‘¥',bg:'var(--zn-blue)',   delay:0},
    {lbl:'New Leads',         val:fmt.num(k.newLeads),  sub:`${k.retLeads} returning`,                              icon:'â¬†', bg:'var(--zn-teal)',   delay:60},
    {lbl:'Conversion Rate',   val:`${k.convRate}%`,     sub:fmt.delta(k.convRate-k.prevConv)+' vs prior',           icon:'âœ…',bg:'var(--zn-green)',  delay:120},
    {lbl:'Revenue Attributed',val:fmt.usd(k.revenue),   sub:fmt.delta(revDelta)+' vs prior',                        icon:'ğŸ’°',bg:'var(--zn-blue-dk)',delay:180},
    {lbl:'Leads at Risk',     val:k.atRisk,             sub:'No activity >5 days',                                  icon:'âš ', bg:'var(--zn-amber)',  delay:240,alert:true},
    {lbl:'Avg Response',      val:fmt.min(k.respMin),   sub:'AI: 18s Â· Human: 9.8m',                               icon:'âš¡',bg:'var(--zn-purple)', delay:300},
    {lbl:'Cost Per Lead',     val:fmt.usd(k.cpl),       sub:'Blended all channels',                                 icon:'ğŸ’¸',bg:'var(--zn-amber)',  delay:360},
    {lbl:'Lead Velocity',     val:`+${k.velocity}%`,    sub:'Rate vs prior period',                                 icon:'ğŸš€',bg:'var(--zn-blue)',   delay:420},
  ];
  document.getElementById('kpi-strip').innerHTML=kpis.map(k=>`
    <div class="kpi-card${k.alert?' alert-card':''}" style="animation-delay:${k.delay}ms">
      <div class="kpi-icon" style="background:${k.bg}20;color:${k.bg}">${k.icon}</div>
      <div class="kpi-label">${k.lbl}</div>
      <div class="kpi-value">${k.val}</div>
      <div class="kpi-sub">${k.sub}</div>
    </div>`).join('');
}

// â”€â”€â”€ FUNNEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFunnel(){
  const max=FUNNEL[0].count;
  document.getElementById('funnel-stages').innerHTML=FUNNEL.map(s=>`
    <div class="funnel-stage" style="background:${s.color}18" onclick="toggleStage('${s.stage}')">
      <div class="funnel-meta">
        <span class="funnel-stage-name" style="color:${s.color}">${s.stage}</span>
        <div style="display:flex;align-items:center;gap:10px">
          ${s.avgDays?`<span style="font-size:10px;color:var(--zn-text-2)">â± ${s.avgDays}d avg</span>`:''}
          ${s.dropOff!==null?`<span class="${s.dropOff>25?'drop-off-hi':'drop-off-md'}">${s.dropOff>25?'ğŸ”´':'ğŸŸ¡'} ${s.dropOff}% drop-off</span>`:''}
          <span class="funnel-count" style="color:${s.color}">${fmt.num(s.count)}</span>
        </div>
      </div>
      <div class="funnel-bar-wrap"><div class="funnel-bar" style="width:${(s.count/max)*100}%;background:${s.color}"></div></div>
      ${s.value>0?`<div style="display:flex;justify-content:space-between;font-size:10px;color:var(--zn-text-2);margin-top:4px"><span>Pipeline value</span><span style="font-weight:700">${fmt.usd(s.value)}</span></div>`:''}
    </div>`).join('');
  document.getElementById('pipeline-val').textContent=fmt.usd(FUNNEL.reduce((s,d)=>s+d.value,0));
}
function toggleStage(s){activeStage=activeStage===s?null:s;}

// â”€â”€â”€ PIE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPie(){
  const ctx=document.getElementById('pieChart').getContext('2d');
  if(pieInst)pieInst.destroy();
  ctx.canvas.width=120;ctx.canvas.height=120;
  pieInst=new Chart(ctx,{type:'doughnut',data:{labels:SOURCES.map(s=>s.name),datasets:[{data:SOURCES.map(s=>s.leads),backgroundColor:COLORS.sources,borderWidth:2,borderColor:'#fff',hoverOffset:4}]},options:{cutout:'60%',responsive:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>`${c.label}: ${c.raw} leads`}}},animation:{duration:800}}});
  const total=SOURCES.reduce((s,d)=>s+d.leads,0);
  document.getElementById('pie-legend').innerHTML=SOURCES.map((s,i)=>`
    <div class="pie-legend-item">
      <span class="pie-dot" style="background:${COLORS.sources[i]}"></span>
      <span style="font-size:11px;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${s.name}</span>
      <span style="font-size:11px;font-weight:700;color:var(--zn-text);margin-left:4px">${s.leads}</span>
    </div>
    <div class="pie-bar-bg"><div class="pie-bar-fill" style="width:${(s.leads/total)*100}%;background:${COLORS.sources[i]}"></div></div>`).join('');
  const best=SOURCES.slice().sort((a,b)=>b.revenue-a.revenue)[0];
  document.getElementById('best-source-badge').innerHTML=`<div style="background:var(--zn-blue-bg);border-radius:var(--r-3);padding:8px 12px;font-size:11px;display:flex;align-items:center;gap:6px"><span>ğŸ†</span><span style="font-weight:700;color:var(--zn-blue)">${best.name}</span><span style="color:var(--zn-text-2)">highest revenue â€” ${fmt.usd(best.revenue)}</span></div>`;
}

// â”€â”€â”€ SOURCE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSourceTable(){
  const sorted=[...SOURCES].sort((a,b)=>sortDir*(b[sortKey]-a[sortKey]));
  const cols=[
    {key:'name',    label:'Source',   render:s=>`<td style="padding:10px 8px"><div style="display:flex;align-items:center;gap:8px"><span class="src-dot" style="background:${COLORS.sources[SOURCES.findIndex(x=>x.name===s.name)]}"></span><span style="font-weight:700">${s.name}</span></div></td>`},
    {key:'leads',   label:'Leads',    render:s=>`<td style="padding:10px 8px;font-weight:700">${fmt.num(s.leads)}</td>`},
    {key:'convRate',label:'Conv %',   render:s=>`<td style="padding:10px 8px"><span class="${s.convRate>25?'conv-hi':s.convRate<20?'conv-lo':'conv-md'}">${s.convRate}%</span></td>`},
    {key:'revenue', label:'Revenue',  render:s=>`<td style="padding:10px 8px;font-weight:700">${fmt.usd(s.revenue)}</td>`},
    {key:'avgDeal', label:'Avg Deal', render:s=>`<td style="padding:10px 8px;color:var(--zn-text-2)">${fmt.usd(s.avgDeal)}</td>`},
    {key:'cpl',     label:'CPL',      render:s=>`<td style="padding:10px 8px;color:var(--zn-text-2)">${s.cpl>0?fmt.usd(s.cpl):'â€”'}</td>`},
  ];
  const hdr=cols.map(c=>`<th onclick="sortTable('${c.key}')">${c.label}${sortKey===c.key?(sortDir>0?' â†“':' â†‘'):''}</th>`).join('');
  const rows=sorted.map(s=>`<tr onmouseover="this.style.background='var(--zn-bg)'" onmouseout="this.style.background=''">${cols.map(c=>c.render(s)).join('')}</tr>`).join('');
  document.getElementById('source-table').innerHTML=`<thead><tr>${hdr}</tr></thead><tbody>${rows}</tbody>`;
}
function sortTable(key){if(sortKey===key)sortDir*=-1;else{sortKey=key;sortDir=-1;}renderSourceTable();}

// â”€â”€â”€ AI vs HUMAN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAIvsHuman(){
  const {ai,human}=AI_VS_HUMAN;
  const metrics=[
    {lbl:'Leads Handled',    aiv:fmt.num(ai.handled),  hv:fmt.num(human.handled), aiW:ai.handled>human.handled},
    {lbl:'Conversion Rate',  aiv:`${ai.convRate}%`,    hv:`${human.convRate}%`,   aiW:ai.convRate>human.convRate},
    {lbl:'Avg Response Time',aiv:fmt.min(ai.respMin),  hv:fmt.min(human.respMin), aiW:true},
    {lbl:'Revenue',          aiv:fmt.usd(ai.revenue),  hv:fmt.usd(human.revenue), aiW:ai.revenue>human.revenue},
    {lbl:'Cost/Conversion',  aiv:fmt.usd(ai.cpc),      hv:fmt.usd(human.cpc),     aiW:true},
    {lbl:'Handoff Rate',     aiv:`${ai.handoff}%`,     hv:'â€”',                    aiW:ai.handoff<20},
  ];
  document.getElementById('ai-metrics').innerHTML=metrics.map(m=>`
    <div class="ai-metric-row">
      <div class="ai-metric-label">${m.lbl}</div>
      <div class="ai-val ${m.aiW?'winner':'loser'}">${m.aiv}${m.aiW?' âœ“':''}</div>
      <div class="vs-sep">vs</div>
      <div class="human-val ${!m.aiW?'winner':'loser'}">${m.hv}${!m.aiW?' âœ“':''}</div>
    </div>`).join('');
  const ctx=document.getElementById('aiTrendChart').getContext('2d');
  if(aiTrendInst)aiTrendInst.destroy();
  aiTrendInst=new Chart(ctx,{type:'line',data:{labels:AI_VS_HUMAN.trend.map(t=>t.m),datasets:[
    {label:'AI Agents',   data:AI_VS_HUMAN.trend.map(t=>t.ai),borderColor:'#3B5D5C',backgroundColor:'rgba(59,93,92,.1)', borderWidth:2.5,pointRadius:4,tension:.3,fill:true},
    {label:'Human Agents',data:AI_VS_HUMAN.trend.map(t=>t.h), borderColor:'#1A78C1',backgroundColor:'rgba(26,120,193,.08)',borderWidth:2.5,pointRadius:4,tension:.3,fill:true},
  ]},options:{plugins:{legend:{labels:{font:{size:11,family:'Lato'},boxWidth:12}}},scales:{y:{min:18,max:32,ticks:{font:{size:10,family:'Lato'},callback:v=>v+'%'},grid:{color:'#E8E8E8'}},x:{ticks:{font:{size:10,family:'Lato'}},grid:{display:false}}},animation:{duration:800}}});
}

// â”€â”€â”€ AGENT LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAgents(){
  const sorted=[...AGENTS].sort((a,b)=>b.convRate-a.convRate);
  const rankLabel=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4ï¸âƒ£'];
  const aiBg={'ai_recept':'var(--zn-teal)','ai_outbound':'var(--zn-purple)','human':'var(--zn-blue)'};
  document.getElementById('agent-list').innerHTML=sorted.map((a,i)=>`
    <div class="agent-row${activeAgent===a.id?' active':''}" id="agent-${a.id}" onclick="toggleAgent('${a.id}')">
      <div style="display:flex;align-items:center;gap:10px">
        <span style="font-size:20px;width:28px;flex-shrink:0">${rankLabel[i]}</span>
        <div class="agent-avatar" style="background:${aiBg[a.type]||'var(--zn-blue)'}">${a.av}</div>
        <div style="flex:1;min-width:0">
          <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
            <span style="font-weight:700;font-size:13px">${a.name}</span>
            <span class="badge ${a.type==='human'?'badge-blue':a.type==='ai_recept'?'badge-teal':'badge-purple'}">${a.type==='human'?'Human':a.type==='ai_recept'?'AI Receptionist':'AI Outbound'}</span>
          </div>
          <div style="font-size:11px;color:var(--zn-text-2)">${a.center}</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:18px;font-weight:700;color:var(--zn-blue)">${a.convRate}%</div>
          <div style="font-size:10px;color:var(--zn-text-2)">conv. rate</div>
        </div>
      </div>
      <div class="agent-detail">
        <div class="agent-stat"><div class="agent-stat-val">${fmt.num(a.handled)}</div><div class="agent-stat-lbl">Leads</div></div>
        <div class="agent-stat"><div class="agent-stat-val">${fmt.usd(a.revenue)}</div><div class="agent-stat-lbl">Revenue</div></div>
        <div class="agent-stat"><div class="agent-stat-val">${fmt.min(a.respMin)}</div><div class="agent-stat-lbl">Avg Response</div></div>
        <div class="agent-stat" style="grid-column:span 3;text-align:left;display:flex;gap:16px;flex-wrap:wrap">
          <span style="font-size:11px;color:var(--zn-text-2)">ğŸ† Best source: <b>${a.bestSrc}</b></span>
          <span style="font-size:11px;color:var(--zn-text-2)">ğŸ’Š Best type: <b>${a.bestType}</b></span>
          <span style="font-size:11px">${fmt.delta(a.convRate-a.prev)} vs prior period</span>
        </div>
      </div>
    </div>`).join('');
}
function toggleAgent(id){activeAgent=activeAgent===id?null:id;renderAgents();}

// â”€â”€â”€ TREND CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let trendView='total';
function setTrendView(v,btn){
  trendView=v;
  document.querySelectorAll('.tab-pill').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');renderTrend();
}
function renderTrend(){
  const days=RANGE_FACTOR[currentRange]===1?60:RANGE_FACTOR[currentRange]===0.5?30:RANGE_FACTOR[currentRange]===0.233?7:1;
  const data=DAILY.slice(-days);
  const ctx=document.getElementById('trendChart').getContext('2d');
  if(trendChartInst)trendChartInst.destroy();
  const labels=data.map(d=>d.date);
  let datasets=[];
  if(trendView==='total'){
    datasets=[{label:'Total Leads',data:data.map(d=>d.total),borderColor:'#1A78C1',backgroundColor:'rgba(26,120,193,.1)',fill:true,borderWidth:2.5,pointRadius:2,tension:.4}];
  } else if(trendView==='sources'){
    datasets=[
      {label:'AI Receptionist',data:data.map(d=>d.ai),  backgroundColor:'#1A78C1',stack:'s'},
      {label:'Facebook',       data:data.map(d=>d.fb),  backgroundColor:'#3B5D5C',stack:'s'},
      {label:'Google',         data:data.map(d=>d.goog),backgroundColor:'#C07A00',stack:'s'},
      {label:'Website',        data:data.map(d=>d.web), backgroundColor:'#6B3FA0',stack:'s'},
    ];
    trendChartInst=new Chart(ctx,{type:'bar',data:{labels,datasets},options:{plugins:{legend:{labels:{font:{size:10,family:'Lato'},boxWidth:10}}},scales:{x:{ticks:{font:{size:9,family:'Lato'},maxTicksLimit:8},stacked:true,grid:{display:false}},y:{stacked:true,ticks:{font:{size:10,family:'Lato'}},grid:{color:'#E8E8E8'}}},animation:{duration:600}}});
    return;
  } else {
    datasets=[
      {label:'New Leads',data:data.map(d=>d.new),borderColor:'#1A78C1',backgroundColor:'rgba(26,120,193,.1)',fill:true,borderWidth:2,pointRadius:1,tension:.4},
      {label:'Returning', data:data.map(d=>d.ret),borderColor:'#3B5D5C',backgroundColor:'rgba(59,93,92,.08)',fill:true,borderWidth:2,pointRadius:1,tension:.4},
    ];
  }
  trendChartInst=new Chart(ctx,{type:'line',data:{labels,datasets},options:{plugins:{legend:{labels:{font:{size:10,family:'Lato'},boxWidth:10}}},scales:{x:{ticks:{font:{size:9,family:'Lato'},maxTicksLimit:8},grid:{display:false}},y:{ticks:{font:{size:10,family:'Lato'}},grid:{color:'#E8E8E8'}}},animation:{duration:600}}});
}

// â”€â”€â”€ TYPE BARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTypes(){
  const maxConv=Math.max(...TYPES.map(t=>t.convRate));
  [...TYPES].sort((a,b)=>b.revenue-a.revenue);
  document.getElementById('type-bars').innerHTML=[...TYPES].sort((a,b)=>b.revenue-a.revenue).map(t=>`
    <div class="type-row">
      <div class="type-meta">
        <span style="display:flex;align-items:center;gap:6px">
          <span style="width:8px;height:8px;border-radius:50%;background:${COLORS.types[TYPES.findIndex(x=>x.name===t.name)]};display:inline-block"></span>
          <span style="font-weight:700;font-size:12px">${t.name}</span>
        </span>
        <span style="display:flex;gap:12px;font-size:11px;color:var(--zn-text-2)">
          <span>${fmt.usd(t.revenue)}</span>
          <span class="${t.convRate>28?'conv-hi':t.convRate<20?'conv-lo':'conv-md'}">${t.convRate}%</span>
          <span>â±${t.days}d</span>
        </span>
      </div>
      <div class="type-bar-bg"><div class="type-bar-fill" style="width:${(t.convRate/maxConv)*100}%;background:${COLORS.types[TYPES.findIndex(x=>x.name===t.name)]}"></div></div>
    </div>`).join('');
}

// â”€â”€â”€ CENTER CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCenters(){
  document.getElementById('center-list').innerHTML=CENTERS.map((c,i)=>`
    <div class="center-card" style="margin-bottom:${i<CENTERS.length-1?'12px':'0'}">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div style="display:flex;align-items:center;gap:10px">
          <span style="font-size:22px;font-weight:900;color:var(--zn-border)">#${i+1}</span>
          <div><div style="font-weight:700;font-size:13px">${c.name}</div><div style="font-size:11px;color:var(--zn-text-2)">${c.agents} agents</div></div>
        </div>
        <div style="text-align:right"><div style="font-size:18px;font-weight:700;color:var(--zn-blue)">${c.convRate}%</div><div style="font-size:10px;color:var(--zn-text-2)">conv rate</div></div>
      </div>
      <div class="center-stats">
        <div class="center-stat"><div class="center-stat-val">${fmt.num(c.leads)}</div><div class="center-stat-lbl">Leads</div></div>
        <div class="center-stat"><div class="center-stat-val">${fmt.usd(c.revenue)}</div><div class="center-stat-lbl">Revenue</div></div>
        <div class="center-stat ${c.atRisk>15?'at-risk-hi':'at-risk-md'}"><div class="center-stat-val">${c.atRisk}</div><div class="center-stat-lbl">At Risk</div></div>
      </div>
    </div>`).join('');
}

// â”€â”€â”€ NURTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderNurture(){
  const channels=[
    {icon:'ğŸ“§',lbl:'Email',      rows:[{k:'Sent',v:fmt.num(NURTURE.email.sent)},{k:'Open Rate',v:`${NURTURE.email.openRate}%`},{k:'Reply Rate',v:`${NURTURE.email.replyRate}%`}]},
    {icon:'ğŸ’¬',lbl:'SMS',       rows:[{k:'Sent',v:fmt.num(NURTURE.sms.sent)},{k:'Response Rate',v:`${NURTURE.sms.responseRate}%`},{k:'Opt-out',v:`${NURTURE.sms.optOut}%`}]},
    {icon:'ğŸ¤–',lbl:'AI Calls',  rows:[{k:'Made',v:fmt.num(NURTURE.aiCall.made)},{k:'Connect Rate',v:`${NURTURE.aiCall.connect}%`},{k:'Conv Rate',v:`${NURTURE.aiCall.conv}%`}]},
    {icon:'ğŸ“',lbl:'Human Calls',rows:[{k:'Made',v:fmt.num(NURTURE.humCall.made)},{k:'Connect Rate',v:`${NURTURE.humCall.connect}%`},{k:'Conv Rate',v:`${NURTURE.humCall.conv}%`}]},
  ];
  document.getElementById('nurture-grid').innerHTML=`<div class="grid-4">${channels.map(c=>`
    <div class="nurture-channel">
      <div style="display:flex;align-items:center;gap:6px;margin-bottom:10px"><span>${c.icon}</span><span style="font-size:12px;font-weight:700">${c.lbl}</span></div>
      ${c.rows.map(r=>`<div class="nurture-metric"><span class="nurture-metric-lbl">${r.k}</span><span class="nurture-metric-val">${r.v}</span></div>`).join('')}
    </div>`).join('')}</div>`;
}

// â”€â”€â”€ RISK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRisk(){
  const visible=RISK_LEADS.filter(l=>!dismissed.has(l.id));
  document.getElementById('risk-count-badge').textContent=`${visible.length} active`;
  document.getElementById('risk-list').innerHTML=visible.map(l=>`
    <div class="risk-card${l.pri==='high'?' critical':''}" id="risk-${l.id}">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div style="display:flex;align-items:center;gap:10px">
          <div style="width:34px;height:34px;border-radius:50%;background:${l.pri==='high'?'var(--zn-red)':l.pri==='medium'?'var(--zn-amber)':'var(--zn-blue)'};color:#fff;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">${l.name.split(' ').map(n=>n[0]).join('')}</div>
          <div><div style="font-weight:700;font-size:13px">${l.name}</div><div style="font-size:11px;color:var(--zn-text-2)">${l.type} Â· ${l.src} Â· ${l.stage}</div></div>
        </div>
        <div style="display:flex;align-items:center;gap:10px;flex-shrink:0">
          <div style="text-align:right"><div style="font-size:12px;font-weight:700;color:var(--zn-red)">${l.days}d stale</div><div style="font-size:11px;color:var(--zn-text-2)">${fmt.usd(l.val)} value</div></div>
          <span class="badge ${l.pri==='high'?'badge-red':l.pri==='medium'?'badge-amber':'badge-blue'}">${l.pri}</span>
        </div>
      </div>
      <div class="risk-actions">
        <button class="btn-action btn-cta">ğŸ“ Call Now</button>
        <button class="btn-action btn-outline-blue">ğŸ’¬ Send SMS</button>
        <button class="btn-action btn-muted">ğŸ‘¤ Assign Agent</button>
        <button class="btn-action btn-dismiss" onclick="dismissRisk('${l.id}')">âœ• Dismiss</button>
      </div>
    </div>`).join('');
}
function dismissRisk(id){dismissed.add(id);renderRisk();}

// â”€â”€â”€ FILTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setRange(r){
  currentRange=r;
  const labelMap={'Today':'Today','7d':'7d','30d':'30d','60d':'60d','custom':'Custom'};
  document.querySelectorAll('.date-pill').forEach(b=>b.classList.toggle('active',b.textContent.trim()===(labelMap[r]||r)));
  const panel=document.getElementById('custom-dates');
  if(panel)panel.style.display=r==='custom'?'flex':'none';
  renderKPIs();renderTrend();
}
function applyFilter(){renderSourceTable();renderAgents();renderTypes();renderCenters();updateFilterChips();}
function updateFilterChips(){
  const filters=[{id:'src-filter',label:'Source'},{id:'ctr-filter',label:'Center'},{id:'type-filter',label:'Type'},{id:'agent-filter',label:'Agent'},{id:'stage-filter',label:'Stage'}];
  const active=filters.filter(f=>document.getElementById(f.id)&&document.getElementById(f.id).value);
  const chipsEl=document.getElementById('active-filter-chips');
  const clearBtn=document.getElementById('clear-filters-btn');
  if(chipsEl)chipsEl.innerHTML=active.map(f=>`<span class="filter-chip">${f.label}: <b>${document.getElementById(f.id).value}</b><button onclick="clearFilter('${f.id}')">âœ•</button></span>`).join('');
  if(clearBtn)clearBtn.style.display=active.length>0?'inline-flex':'none';
}
function clearFilter(id){const el=document.getElementById(id);if(el){el.value='';applyFilter();}}
function clearAllFilters(){
  ['src-filter','ctr-filter','type-filter','agent-filter','stage-filter'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  const s=document.getElementById('lead-search');if(s)s.value='';applyFilter();
}
function applySearch(val){updateFilterChips();const c=document.getElementById('clear-filters-btn');if(c&&val.trim())c.style.display='inline-flex';}

// â”€â”€â”€ CHATBOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let chatOpen=false;
function toggleChat(){
  chatOpen=!chatOpen;
  document.getElementById('chat-panel').classList.toggle('open',chatOpen);
  document.getElementById('chat-fab').style.display=chatOpen?'none':'flex';
  if(chatOpen&&document.getElementById('chat-messages').childElementCount===0)
    addMsg('ai',"Hi! I'm your Zenoti Analytics Assistant. I have full context of your lead data.\n\nAsk me anything, or pick a suggestion below ğŸ‘‡");
}
const CHAT_CATS={
  'Lead Sources':["Which lead sources are performing best this month?","Compare Facebook vs AI Receptionist conversion rates","Which source has the highest cost per lead?"],
  'Agent Performance':["Who are my top 3 converting agents?","Which agents have the slowest response times?","How is my AI agent performing vs human agents?"],
  'Funnel & Conversion':["Where are leads dropping off the most?","Which lead types convert fastest?","Show me leads stuck in Interested stage for 7+ days"],
  'Revenue & ROI':["What's my estimated pipeline value right now?","Which lead sources are driving the most revenue?","What's my ROI on Facebook vs Google Ads?"],
  'Nurture':["Which leads haven't been contacted in 5+ days?","What's my SMS response rate this month?","Show me leads that re-engaged after follow-up"],
};
const CANNED={
  "Which lead sources are performing best this month?":{t:"Based on your data:\n\nğŸ¥‡ AI Receptionist â€” 28.5% conv, $187,400 revenue, $0 CPL\nğŸ¥ˆ Referral â€” 32.1% conv (best rate!) but lower volume\nğŸ¥‰ Google Ads â€” highest avg deal size ($2,321)\n\nğŸ’¡ Your AI Receptionist generates 25% of all leads at zero ad spend. It's your best-performing channel across every metric.",a:"View Source Dashboard"},
  "Compare Facebook vs AI Receptionist conversion rates":{t:"Head-to-head:\n\nMetric          | Facebook | AI Recept.\nLeads           | 287      | 312\nConv. Rate      | 21.9%    | 28.5% âœ“\nRevenue         | $121.8K  | $187.4K âœ“\nCPL             | $94      | $0 âœ“\nAvg Deal        | $1,933   | $2,106 âœ“\n\nAI Receptionist wins on every dimension AND costs nothing in ad spend.",a:"View Comparison"},
  "Where are leads dropping off the most?":{t:"Your biggest bottleneck is Qualified â†’ Booked at 36.4% drop-off ğŸ”´\n\nFull breakdown:\nâ€¢ New â†’ Contacted: 12.7% âœ…\nâ€¢ Contacted â†’ Interested: 22.2% âš ï¸\nâ€¢ Interested â†’ Qualified: 27.7% ğŸ”´\nâ€¢ Qualified â†’ Booked: 36.4% ğŸ”´ (critical)\nâ€¢ Booked â†’ Won: 18.5% âœ…\n\nğŸ’¡ Fix: Same-day booking incentives + automated scheduling for qualified leads could recover ~72 additional bookings/month.",a:"View Qualified Stage Leads"},
  "What's my estimated pipeline value right now?":{t:"Current pipeline by stage:\n\nâ€¢ New:        $2,619,000 (1,247 leads)\nâ€¢ Contacted:  $2,287,000 (1,089)\nâ€¢ Interested: $1,779,000 (847)\nâ€¢ Qualified:  $1,285,000 (612)\nâ€¢ Booked:     $817,000 (389)\n\nTotal Pipeline: $8,787,000\nExpected Revenue @ 25.4% conv: ~$2,232,000",a:"View Full Pipeline"},
  "Who are my top 3 converting agents?":{t:"Your top 3 agents by conversion rate:\n\nğŸ¥‡ Nexus AI (AI Outbound) â€” 27.7% conv\n   44 won / 159 handled, responds in 6 seconds\n\nğŸ¥ˆ Aria AI (AI Receptionist) â€” 26.2% conv\n   128 won / 489 handled, $218,700 revenue\n\nğŸ¥‰ Sarah Chen â€” 25.0% conv\n   78 won / 312 handled, $164,800 revenue\n   Excels at Membership + Referral leads\n\nâš ï¸ Marcus Rivera dropped 1.5pp vs prior period â€” may benefit from coaching.",a:"View Agent Details"},
  "Which leads haven't been contacted in 5+ days?":{t:"You have 47 at-risk leads:\n\nğŸ”´ Critical (8-9 days stale):\nâ€¢ Emma Wilson â€” CoolSculpting, $2,400 value\nâ€¢ James Park â€” Membership, $1,800 value\n\nğŸŸ¡ High Priority (6-7 days):\nâ€¢ Sofia Martinez â€” Botox, $850\nâ€¢ Noah Thompson â€” Laser, $1,200\n\n+ 43 more in the 5-6 day range.\n\nTotal at-risk value: ~$84,600\n\nğŸ’¡ Recommend: trigger SMS nurture sequence for all 47 now.",a:"Start Nurture Sequence"},
};
let activeCat='Lead Sources';
function renderChatUI(){
  document.getElementById('chip-cats').innerHTML=Object.keys(CHAT_CATS).map(c=>`<button class="chip-cat${c===activeCat?' active':''}" onclick="setChatCat('${c}')">${c}</button>`).join('');
  document.getElementById('chip-list').innerHTML=(CHAT_CATS[activeCat]||[]).map(p=>`<button class="chip" onclick="sendCanned('${p.replace(/'/g,"\\'")}')">${p}</button>`).join('');
}
function setChatCat(c){activeCat=c;renderChatUI();}
function sendCanned(p){addMsg('user',p);respondTo(p);}
function addMsg(role,text,action){
  const wrap=document.createElement('div');wrap.className=`msg-wrap ${role}`;
  const icon=document.createElement('div');icon.className=`msg-icon ${role}`;icon.textContent=role==='ai'?'âœ¦':'U';
  const bub=document.createElement('div');bub.className=`msg-bubble ${role}`;bub.style.whiteSpace='pre-wrap';bub.textContent=text;
  if(action&&role==='ai'){const btn=document.createElement('button');btn.className='msg-action';btn.textContent=`â†’ ${action}`;bub.appendChild(btn);}
  wrap.appendChild(icon);wrap.appendChild(bub);
  document.getElementById('chat-messages').appendChild(wrap);
  document.getElementById('chat-messages').scrollTop=9999;
}
function showThinking(){
  const wrap=document.createElement('div');wrap.className='msg-wrap ai';wrap.id='thinking-bubble';
  wrap.innerHTML='<div class="msg-icon ai">âœ¦</div><div class="thinking"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
  document.getElementById('chat-messages').appendChild(wrap);
  document.getElementById('chat-messages').scrollTop=9999;
}
function hideThinking(){const t=document.getElementById('thinking-bubble');if(t)t.remove();}
async function respondTo(text){
  showThinking();
  await new Promise(r=>setTimeout(r,700+Math.random()*500));
  hideThinking();
  const canned=CANNED[text];
  if(canned){addMsg('ai',canned.t,canned.a);return;}
  const q=text.toLowerCase();let resp;
  if(q.includes('revenue')||q.includes('roi'))
    resp="Your 60-day attributed revenue is $698,400. AI Receptionist leads the way at $187,400, followed by Google Ads ($134,600) and Beverly Hills center ($242,100). Your conversion rate of 25.4% is above the medspa industry average of 20â€“30%.";
  else if(q.includes('sms'))
    resp="SMS analytics: 1,934 messages sent Â· 22.4% response rate (industry avg ~15%) Â· 1.2% opt-out rate (healthy). Leads contacted via SMS within 5 minutes convert 40% better than those contacted later.";
  else if(q.includes('center')||q.includes('location'))
    resp="Center rankings:\nğŸ¥‡ Beverly Hills â€” 487 leads, 26.8% conv, $242K revenue\nğŸ¥ˆ Santa Monica â€” 412 leads, 23.1% conv, $199K revenue\nğŸ¥‰ Pasadena â€” 348 leads, 21.4% conv, $158K revenue\n\nPasadena has the most at-risk leads (17) â€” consider additional staffing there.";
  else if(q.includes('membership'))
    resp="Membership leads have your best conversion rate at 35.9% and a $1,800 avg deal size â€” your highest-value repeatable lead type. Nexus AI outbound agent is especially effective here (33.1% conv rate).";
  else
    resp=`I've analyzed your lead data for: "${text}"\n\nWith 1,247 leads, 25.4% conversion, and $698K revenue this period, you're tracking above industry benchmarks. Would you like me to drill into a specific segment or time period?`;
  addMsg('ai',resp);
}
function sendChat(){
  const inp=document.getElementById('chat-input'),text=inp.value.trim();
  if(!text)return;inp.value='';addMsg('user',text);respondTo(text);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load',function(){
  renderKPIs();renderFunnel();renderPie();renderSourceTable();
  renderAIvsHuman();renderAgents();renderTrend();renderTypes();
  renderCenters();renderNurture();renderRisk();renderChatUI();updateFilterChips();
  setTimeout(()=>{
    const loading=document.getElementById('loading');
    loading.style.opacity='0';loading.style.transition='opacity .4s';
    setTimeout(()=>loading.remove(),400);
  },400);
});
</script>
</body>
</html>
